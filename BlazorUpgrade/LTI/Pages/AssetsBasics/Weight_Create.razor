@using CalibrationSaaS.Infraestructure.Blazor.Shared
@inject HttpClient Http
@* @inject IJSRuntime JSRuntime

@inject ILogger<Weight_Create> Logger *@
@using System.Linq;
@using CalibrationSaaS.Domain.Aggregates.Shared.Basic;
@using Blazed.Controls
@using CalibrationSaaS.Domain.Aggregates.Querys 
@inherits CalibrationSaaS.Infraestructure.Blazor.Pages.AssetsBasics.Weight_CreateBase
@if (LIST1 != null )
{
    @*<EditForm  EditContext="@EditContext">
        <DataAnnotationsValidator />*@
    <div class="row">
        <div class="col-sm-12">
            @if (!POE.IsForAccreditedCal && EquipmentTypeObject.CalibrationTypeID != 4)
            {
            
                <ResponsiveTable ItemsDataSource="@LIST1" 
                                 PageSize="20" HasAction="true"
                                 TableItem="WeightSet" @ref="RT" InLineEdit="true"
                                 EnabledModal="false" Context="Entity" 
                                 NewButtonText="Add Non Accredited Weight Set"
                                 NewItemDefaultItem="DefaultItem"
                                 DeleteAction ="Delete"
                                 Component="@Component"
                                 ColActionCSS="col-sm">
                  


                    <ChildContent>

                        <GridColumns>
                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.Reference)" DefaultSort="true" Title="Reference" />

                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.WeightNominalValue)" DefaultSort="true" Title="Weight" />

                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.UnitOfMeasure.Abbreviation)" Title="UoM">

                                <ResponsiveTemplate>
                                    @{ var entity = context as WeightSet;

                                        entity.UnitOfMeasureID.GetUoM(AppState.UnitofMeasureList);

                                        var a = entity.UnitOfMeasureID.GetUoM(AppState.UnitofMeasureList);

                                        @a.Abbreviation;

                                    }
                                </ResponsiveTemplate>

                            </GridColumn>
                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.MPE)" Title="MPE" />
                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.Note)" Title="Note" />
                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.PieceOfEquipmentStatus)" Title="Status" />

                        </GridColumns>


                    </ChildContent>


                    <GridRow>
                        @*<div class="col-sm-2 customcol inv">WeightValue</div>
                        <div class="col-sm-2 customcol">@Entity.WeightNominalValue</div>
                        <div class="col-sm-2 customcol inv">UnitOfMeasurement</div>
                        <div class="col-sm-2 customcol">@Entity.UnitOfMeasureID</div>
                        <div class="col-sm-2 customcol inv">Note</div>
                        <div class="col-sm-2 customcol">@Entity.Note</div>
                        <div class="col-sm-2 customcol inv">PoEStatus</div>
                        <div class="col-sm-2 customcol">@Entity.PieceOfEquipmentStatus</div>*@
                    </GridRow>
                
                    <GridEdit>
                        <div class="col-sm-2 customcol inv">#Ref</div>
                        <div class="col-sm-2 customcol">
                            <TextInput @bind-Value="@Entity.Reference" Validate="false" IsDisabled="!Enabled" Label="Reference" LabelDown="false">

                            </TextInput>
                            @RT.GetErrorMessage(nameof(Entity.Reference))
                        </div>
                        <div class="col-sm-2 customcol inv">WeightValue</div>
                        <div class="col-sm-2 customcol">
                            <TextInput @bind-Value="@Entity.WeightNominalValue" 
                                       Validate="false" 
                                       IsDisabled="!Enabled" 
                                       Label="Weight Value" 
                                       LabelDown="false"
                                       Type=@Types.numberdecimal
                                       StepResol="1"
                                       DecimalRoundType="RoundType.Without"
                                       EnableToastMessage="true"
                                       ToastMessage="No decimals permited">

                            </TextInput>
                            @RT.GetErrorMessage(nameof(Entity.WeightNominalValue))
                        </div>
                        <div class="col-sm-2 customcol inv">UnitOfMeasurement</div>
                        <div class="col-sm-2 customcol">



                            <TextInput @bind-Value="@Entity.UnitOfMeasureID"
                                       LabelDown="LabelDown"
                                       IsDisabled="!Enabled"
                                       Label="Unit Of Measure"
                                       OnChangeControl="ChangeUOM"
                                       ValidationFor="@(() => Entity.UnitOfMeasureID)"
                                       Type="@Types.select">
                                @foreach (UnitOfMeasure item in AppState.GetUoMByEquipmentType(EquipmentTypeObject))
                                {
                                    <option value="@item.UnitOfMeasureID">@item.Name</option>
                                }
                            </TextInput>




                        </div>
                        <div class="col-sm-2 customcol inv">Note</div>
                        <div class="col-sm-2 customcol">
                            <TextInput @bind-Value="@Entity.Note" Validate="false" IsDisabled="!Enabled" Label="Note" LabelDown="false">

                            </TextInput>
                            @RT.GetErrorMessage(nameof(Entity.Note))
                        </div>
                       @* <div class="col-sm-2 customcol inv">PoEStatus</div>
                        <div class="col-sm-2 customcol">
                            <TextInput @bind-Value="@Entity.PieceOfEquipmentStatus" Validate="false" IsDisabled="!Enabled" Label="PoE Status" LabelDown="false" hidden="hidden">

                            </TextInput>
                            @RT.GetErrorMessage(nameof(Entity.PieceOfEquipmentStatus))
                        </div>*@
                        @{ 
                            Entity.WeightActualValue = @Entity.WeightNominalValue;
                            Entity.Divisor = 1;
                        }
                    </GridEdit>
                </ResponsiveTable>
            }
            else if (POE.IsForAccreditedCal && EquipmentTypeObject.CalibrationTypeID != 4)
            {
       
                 <ResponsiveTable ItemsDataSource="@LIST1"
                                                         PageSize="20"
                                                         HasAction="true"
                                                         TableItem="WeightSet"
                                                         @ref="RT"
                                                         RowEditClass=""
                                                         RowNewClass=""
                                                         InLineEdit=false
                                                         Context="Entity"
                                                         EnabledSearch="false"
                                                         NewItemDefaultItem="DefaultItemAcr"
                                                         EnabledModal="false"
                                                         NewButtonText="Add Accredited Weight Set"
                                                         Component="@Component"
                                                         ColActionCSS="col-sm">


               <ChildContent>

                <GridColumns>
                    <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.Reference)" DefaultSort="true" Title="Reference" />
                    <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.WeightNominalValue)" DefaultSort="true" Title="Weight" />
                    <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.WeightActualValue)" Title="Weight" />
                    <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.UnitOfMeasure.Abbreviation)" Title="UoM">

                        <ResponsiveTemplate>
                            @{
                                var entity = context as WeightSet;

                                        if (entity != null)
                                        
                                        {
                                            var a = entity.UnitOfMeasureID.GetUoM(AppState.UnitofMeasureList);
                                            if(a != null){
                                                @a.Abbreviation
                                                ;

                                            }
                                            
                                        }

                              

                            }
                        </ResponsiveTemplate>

                    </GridColumn>

                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.CalibrationUncertValue)" Title="Calibration Uncertainty" />
                            <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.UnitOfMeasure.Abbreviation)" Title="UoMUncertainty">

                                <ResponsiveTemplate>
                                    @{
                                        var entity = context as WeightSet;

                                        var a = entity.UncertaintyUnitOfMeasureId.GetUoM(AppState.UnitofMeasureList);

                                        @a.Abbreviation
                                        ;

                                    }
                                </ResponsiveTemplate>

                            </GridColumn>
                            

                    <GridColumn TableItem="WeightSet" Field="@RT.GetPropertyName(() => eqWeightSet.Note)" Title="Note" />


                </GridColumns>


                </ChildContent>

                <GridRow>
               
                </GridRow>
                <GridEdit>
                    <div class="row">
                        <div class="col-md-12 mx-auto">
                            <form>

                                <div class="form-group row">
                                    <div class="col-sm-4">

                                        <TextInput Label="#Ref" @bind-Value="@Entity.Reference"
                                                   Validate="false" ValidationFor="@(() => @Entity.Reference)" Type="@Types.text" IsDisabled="!Enabled">

                                        </TextInput>
                                        @RT.GetErrorMessage(nameof(Entity.Reference))


                                    </div>


                                    <div class="col-sm-4">

                                        <TextInput Label="Weight Nominal Value" @bind-Value="@Entity.WeightNominalValue"
                                                   Validate="false" ValidationFor="@(() => @Entity.WeightNominalValue)" 
                                                   Type=@Types.numberdecimal
                                                   DecimalRoundType="RoundType.Normal"
                                                   IsDisabled="!Enabled">

                                        </TextInput>
                                        @RT.GetErrorMessage(nameof(Entity.WeightNominalValue))


                                    </div>
                                    <div class="col-sm-4">

                                        @*<label>Weight Actual Value</label>
                <InputNumber @bind-Value="@Entity.WeightActualValue" class="form-control">
                </InputNumber>
                @RT.GetErrorMessage(nameof(Entity.WeightActualValue))*@

                                        <TextInput Label="Weight Actual Value" @bind-Value="@Entity.WeightActualValue"
                                                   Validate="false" ValidationFor="@(() => @Entity.WeightActualValue)" Type="@Types.number" IsDisabled="!Enabled">

                                        </TextInput>
                                        @RT.GetErrorMessage(nameof(Entity.WeightActualValue))


                                    </div>
                              
                                </div>
                                <div class="form-group row">
                                    @* <div class="col-sm-4">


                                        <TextInput Label="Unit of Measure" @bind-Value="@Entity.UnitOfMeasureID"
                                                   Validate="false" Type="@Types.select" IsDisabled="!Enabled">
                                               
                                        </TextInput>
                                        @RT.GetErrorMessage(nameof(Entity.UnitOfMeasureID))


                                    </div> *@
                                        <div class="col-sm-4">
                                        <TextInput @bind-Value="@Entity.UnitOfMeasureID"
                                                   LabelDown="LabelDown"
                                                   IsDisabled="!Enabled"
                                                   Label="Unit Of Measure"
                                                   OnChangeControl="ChangeUOM"
                                                   ValidationFor="@(() => Entity.UnitOfMeasureID)"
                                                   Type="@Types.select">
                                            @foreach (UnitOfMeasure item in AppState.GetUoMByEquipmentType(EquipmentTypeObject))
                                            {

                                                    if (item.UnitOfMeasureID == Entity.UncertaintyUnitOfMeasureId)
                                                    {
                                                        <option value="@item.UnitOfMeasureID" selected>@item.Name</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.UnitOfMeasureID">@item.Name</option>
                                                    }
                                            }
                                        </TextInput>

                                        </div>
                                    <div class="col-sm-4">

                                        <TextInput @bind-Value="@Entity.CalibrationUncertValue" Validate="false" IsDisabled="!Enabled" Label="Calibration Uncertainty Value">
                                        </TextInput>
                                        @RT.GetErrorMessage(nameof(Entity.CalibrationUncertValue))

                              

                                    </div>
                                    <div class="col-sm-4">

                                                <TextInput @bind-Value="@Entity.UncertaintyUnitOfMeasureId"
                                                               LabelDown="LabelDown"
                                                               IsDisabled="!Enabled"
                                                           Label="Uncertainty Value Unit Of Measure"
                                                               OnChangeControl="ChangeUOM"
                                                           ValidationFor="@(() => Entity.UncertaintyUnitOfMeasureId)"
                                                               Type="@Types.select">
                                                    @foreach (UnitOfMeasure item in AppState.GetUoMByEquipmentType(EquipmentTypeObject))
                                                        {
                                                    if (item.UnitOfMeasureID == Entity.UncertaintyUnitOfMeasureId)
                                                    {
                                                        <option value="@item.UnitOfMeasureID" selected>@item.Name</option>
                                                    }
                                                       else{
                                                           <option value="@item.UnitOfMeasureID">@item.Name</option>
                                                       }
                                                        }
                                                    </TextInput>
                                         
                                    </div>
                              
                                </div>
                                <div class="form-group row">
                                            <div class="col-sm-4">

                                                <TextInput @bind-Value="@Entity.Distribution"
                                                           Label="Distribution" Validate="false"
                                                           Type="@Types.select" OnChangeControl="(arg)=>Changetype(arg,Entity)"
                                                           IsDisabled="!Enabled">
                                                    @foreach (WeightDistribution item in AppState2.WeightDistributionList)
                                                    {
                                                        <option value="@item.WeightDistributionID.ToString()">@item.Name</option>
                                                    }
                                                </TextInput>

                                                @RT.GetErrorMessage(nameof(Entity.Distribution))


                                            </div>
                                    <div class="col-sm-4">
                                        <div class="custom-control custom-switch">

                                            <TextInput Label="Divisor" @bind-Value="@Entity.Divisor"
                                                       Validate="false" ValidationFor="@(() => @Entity.Divisor)" IsDisabled="!Enabled">

                                            </TextInput>
                                            @RT.GetErrorMessage(nameof(Entity.Divisor))
                                        </div>
                                    </div>
                                    <div class="col-sm-4">


                                        <TextInput Label="Type" @bind-Value="@Entity.Type"
                                                   Validate="false" Type="@Types.select" IsDisabled="!Enabled">
                                            @foreach (WeightType item in AppState2.WeightTypeList)
                                                    {
                                                <option value="@item.WeightTypeID.ToString()">@item.Name</option>
                                                    }
                                        </TextInput>
                                        @RT.GetErrorMessage(nameof(Entity.Type))


                                    </div>
                                
                                    @*<div class="col-sm-4">
                                        <div class="custom-control custom-switch">
                                                    <label>PoE Status</label>

                                                   <InputSelect @bind-Value="Entity.PieceOfEquipmentStatus" class="form-control">

                            @foreach (KeyValuePair<string, string> item in AppState.StatusList)
                                    {
                                <option value="@item.Key">@item.Value</option>
                                    }
                        </InputSelect>
                        @RT.GetErrorMessage(nameof(Entity.PieceOfEquipmentStatus))
                </div>

            </div>
                                </div>*@
                                </div>
                                    <div class="form-group row">
                                        <div class="col-sm">

                                            <TextInput @bind-Value="@Entity.MPE" Validate="true" IsDisabled="!Enabled" Label="MPE" ValidationFor="@(() => @Entity.MPE)">
                                            </TextInput>
                                            @RT.GetErrorMessage(nameof(Entity.Note))


                                        </div>
                                    </div>
                                <div class="form-group row">
                                    <div class="col-sm">
                                   
                                            <TextInput @bind-Value="@Entity.Note" Validate="true"  IsDisabled="!Enabled" Label="Note" ValidationFor="@(() => @Entity.Note)">
                                            </TextInput>
                                            @RT.GetErrorMessage(nameof(Entity.Note))
                                   

                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </GridEdit>
                </ResponsiveTable>

            }


        </div>
    </div>

}

@code


{

    public void ChangeUOM(ChangeEventArgs arg)
    {
        StateHasChanged();
    }




}
