@using Radzen
@using Radzen.Blazor
@using Microsoft.AspNetCore.Components.Routing
@inject NavigationManager NavigationManager

<div class="submenu-container @(IsCollapsed ? "collapsed" : "")">
    <div class="submenu-content">
        <div class="navigation-buttons">
            <Blazed.Controls.BackComponent>
            </Blazed.Controls.BackComponent>
        </div>

        <div class="context-buttons">
            @if (ContextButtons != null)
            {
                @ContextButtons
            }
            else if (PageButtons != null)
            {
                @PageButtons
            }
            else
            {
                @GetDefaultButtons()
            }
        </div>

        <div class="pin-button">
            <RadzenButton Icon="@(IsPinned ? "push_pin" : "push_pin_outlined")"
                          ButtonStyle="ButtonStyle.Light"
                          Click="TogglePin"
                          Title="@(IsPinned ? "Unpin submenu" : "Pin submenu")" />
        </div>
    </div>
</div>

@if (IsCollapsed)
{
    <div class="submenu-toggle-button">
        <RadzenButton Icon="keyboard_arrow_down"
                      ButtonStyle="ButtonStyle.Secondary"
                      Click="ToggleCollapse"
                      Size="ButtonSize.Small"
                      Title="Show submenu" />
    </div>
}

@code {
    [Parameter] public RenderFragment ContextButtons { get; set; }
    [Parameter] public RenderFragment PageButtons { get; set; }
    [Parameter] public EventCallback NavigateBackClick { get; set; }
    [Parameter] public EventCallback NavigateForwardClick { get; set; }
    [Parameter] public EventCallback<bool> PinnedChanged { get; set; }

    private bool IsPinned { get; set; } = true;
    private bool IsCollapsed => !IsPinned;

    private async Task NavigateBack()
    {
        await NavigateBackClick.InvokeAsync();
    }

    private async Task NavigateForward()
    {
        await NavigateForwardClick.InvokeAsync();
    }

    private async Task TogglePin()
    {
        IsPinned = !IsPinned;
        await PinnedChanged.InvokeAsync(IsPinned);
    }

    private void ToggleCollapse()
    {
        IsPinned = true;
    }

    private RenderFragment GetDefaultButtons()
    {
        // Get the current route
        var currentRoute = NavigationManager.Uri.Replace(NavigationManager.BaseUri, "").Split('?')[0];

        // Return different buttons based on the route
        return (builder) =>
        {
            if (currentRoute == "" || currentRoute == "/")
            {
                builder.OpenElement(0, "div");
                builder.AddAttribute(1, "class", "default-buttons");

                builder.OpenComponent<RadzenButton>(2);
                builder.AddAttribute(3, "Text", "New Customer");
                builder.AddAttribute(4, "Icon", "person_add");
                builder.AddAttribute(5, "ButtonStyle", ButtonStyle.Primary);
                builder.AddAttribute(6, "Click", EventCallback.Factory.Create<MouseEventArgs>(this, () => NavigationManager.NavigateTo("/customers/new")));
                builder.AddAttribute(7, "class", "rz-mr-2 action-button");
                builder.CloseComponent();

                builder.OpenComponent<RadzenButton>(8);
                builder.AddAttribute(9, "Text", "New Asset");
                builder.AddAttribute(10, "Icon", "inventory");
                builder.AddAttribute(11, "ButtonStyle", ButtonStyle.Primary);
                builder.AddAttribute(12, "Click", EventCallback.Factory.Create<MouseEventArgs>(this, () => NavigationManager.NavigateTo("/assets/new")));
                builder.AddAttribute(13, "class", "rz-mr-2 action-button");
                builder.CloseComponent();

                builder.OpenComponent<RadzenButton>(14);
                builder.AddAttribute(15, "Text", "New Order");
                builder.AddAttribute(16, "Icon", "shopping_cart");
                builder.AddAttribute(17, "ButtonStyle", ButtonStyle.Primary);
                builder.AddAttribute(18, "Click", EventCallback.Factory.Create<MouseEventArgs>(this, () => NavigationManager.NavigateTo("/orders/new")));
                builder.AddAttribute(19, "class", "action-button");
                builder.CloseComponent();

                builder.CloseElement();
            }
            else if (currentRoute.StartsWith("customers"))
            {
                builder.OpenElement(0, "div");
                builder.AddAttribute(1, "class", "default-buttons");

                builder.OpenComponent<RadzenButton>(2);
                builder.AddAttribute(3, "Text", "New Customer");
                builder.AddAttribute(4, "Icon", "person_add");
                builder.AddAttribute(5, "ButtonStyle", ButtonStyle.Primary);
                builder.AddAttribute(6, "Click", EventCallback.Factory.Create<MouseEventArgs>(this, () => NavigationManager.NavigateTo("/customers/new")));
                builder.AddAttribute(7, "class", "action-button");
                builder.CloseComponent();

                builder.CloseElement();
            }
            // Add more route-specific buttons as needed
        };
    }
}

<style>
    .submenu-container {
        padding: 0.5rem 1.5rem;
        height: 60px;
        display: flex;
        align-items: center;
        transition: height 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
    }

        .submenu-container.collapsed {
            height: 0;
            opacity: 0;
            transform: translateY(-10px);
            overflow: hidden;
            padding: 0 1.5rem;
        }

    .submenu-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        height: 46px;
        background-color: var(--rz-secondary);
        color: var(--rz-text-contrast-color);
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        padding: 0 1rem;
        overflow-x: auto;
    }

    .navigation-buttons {
        display: flex;
        align-items: center;
        min-width: 90px;
        flex-shrink: 0;
    }

    .context-buttons {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-grow: 1;
        overflow-x: auto;
        padding: 0 0.5rem;
    }

    .pin-button {
        min-width: 40px;
        display: flex;
        justify-content: flex-end;
        flex-shrink: 0;
    }

    .default-buttons {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
    }

    .submenu-toggle-button {
        position: fixed;
        top: 56px; /* Adjust this value to match your header height */
        right: 20px;
        z-index: 100;
    }

    :root[data-theme="dark"] .submenu-content {
        background-color: var(--rz-secondary);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    /* Responsive styles */
    @@media (max-width: 768px) {
        .submenu-container {
            padding: 0.5rem 0.5rem;
            height: auto;
        }

        .submenu-content {
            height: auto;
            flex-wrap: wrap;
            padding: 0.5rem;
        }

        .navigation-buttons {
            order: 1;
            margin-bottom: 0.5rem;
            width: auto;
        }

        .context-buttons {
            order: 3;
            flex-basis: 100%;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .pin-button {
            order: 2;
            margin-left: auto;
        }

        .default-buttons {
            flex-direction: column;
            align-items: stretch;
            width: 100%;
        }

            .default-buttons .action-button {
                margin-right: 0 !important;
                margin-bottom: 0.5rem;
                width: 100%;
                display: flex;
                justify-content: flex-start;
            }

                .default-buttons .action-button:last-child {
                    margin-bottom: 0;
                }

        .submenu-toggle-button {
            top: 50px;
            right: 10px;
        }

        .nav-button {
            padding: 0.3rem;
        }
    }

    @@media (max-width: 480px) {
        .submenu-container {
            padding: 0.3rem;
        }
    }
</style>