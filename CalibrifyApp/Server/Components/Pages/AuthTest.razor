@page "/auth-test"
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@using CalibrifyApp.Server.Services
@using Microsoft.AspNetCore.Authorization

@inherits CustomKavokuComponentBase

<PageTitle>Authentication Test</PageTitle>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-0 rounded-lg mt-5">
                <div class="card-header">
                    <h3 class="text-center font-weight-light my-4">Authentication Test</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info" role="alert">
                        <h4 class="alert-heading">Authentication Status</h4>
                        <p>This page tests the current authentication state.</p>
                        <hr>
                        @if (authState != null)
                        {
                            <p><strong>Is Authenticated:</strong> @authState.User.Identity?.IsAuthenticated</p>
                            <p><strong>Identity Name:</strong> @authState.User.Identity?.Name</p>
                            <p><strong>Authentication Type:</strong> @authState.User.Identity?.AuthenticationType</p>
                            
                            <h5 class="mt-3">Claims:</h5>
                            <ul>
                                @foreach (var claim in authState.User.Claims)
                                {
                                    <li><strong>@claim.Type:</strong> @claim.Value</li>
                                }
                            </ul>
                            
                            <h5 class="mt-3">Policy Checks:</h5>
                            <ul>
                                <li><strong>Read Policy:</strong> @isInReadPolicy</li>
                                <li><strong>Write Policy:</strong> @isInWritePolicy</li>
                                <li><strong>Admin Policy:</strong> @isInAdminPolicy</li>
                            </ul>
                        }
                        else
                        {
                            <p>Loading authentication state...</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private AuthenticationState authState;
    private bool isInReadPolicy;
    private bool isInWritePolicy;
    private bool isInAdminPolicy;

    protected override async Task OnInitializedAsync()
    {
        // Get the authentication state
        authState = await stateTask;
        
        // Check policies
        isInReadPolicy = await IsInPolicy(Policies.Read);
        isInWritePolicy = await IsInPolicy(Policies.Write);
        isInAdminPolicy = await IsInPolicy(Policies.Admin);
    }
}
