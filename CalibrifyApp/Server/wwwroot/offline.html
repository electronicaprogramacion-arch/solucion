<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calibrify - Offline Mode</title>
    <link rel="icon" type="image/svg+xml" href="img/logo/favicon.svg" />
    <link href="lib/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="css/sb-admin-2.css" rel="stylesheet">
    <link href="css/site.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f8f9fc;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .offline-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
        }

        .logo {
            max-width: 200px;
            margin-bottom: 2rem;
        }

        .offline-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #4e73df;
        }

        .offline-message {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #5a5c69;
            max-width: 600px;
        }

        .action-button {
            display: inline-block;
            font-weight: 600;
            color: #fff;
            background-color: #4e73df;
            border: none;
            border-radius: 0.35rem;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            line-height: 1.5;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            margin: 0.5rem;
        }

        .action-button:hover {
            background-color: #2e59d9;
            color: #fff;
            text-decoration: none;
        }

        .action-button.secondary {
            background-color: #858796;
        }

        .action-button.secondary:hover {
            background-color: #717384;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            margin-top: 2rem;
            font-size: 1rem;
            color: #5a5c69;
        }

        .status-dot {
            height: 12px;
            width: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
            background-color: #e74a3b;
        }

        .footer {
            text-align: center;
            padding: 1rem;
            background-color: #fff;
            color: #858796;
            font-size: 0.875rem;
            border-top: 1px solid #e3e6f0;
        }
    </style>
</head>
<body>
    <div class="offline-container">
        <img src="img/logo/Transparent Logo.svg" alt="Calibrify Logo" class="logo">
        <h1 class="offline-title">You're Offline</h1>
        <p class="offline-message">
            You appear to be offline. Calibrify can still work in offline mode with limited functionality.
            You can continue working with previously loaded data or try reconnecting when your internet connection is restored.
        </p>

        <div>
            <button id="continueOfflineBtn" class="action-button">Continue in Offline Mode</button>
            <button id="retryConnectionBtn" class="action-button secondary">Retry Connection</button>
        </div>

        <div class="status-indicator">
            <span class="status-dot"></span>
            <span>Currently offline</span>
        </div>
    </div>

    <div class="footer">
        <p>Copyright &copy; Kavoku, LLC 2020-2024</p>
    </div>

    <script>
        // Check if we're in a PWA
        const isPwa = window.matchMedia('(display-mode: standalone)').matches ||
                      window.navigator.standalone ||
                      document.referrer.includes('android-app://');

        // Function to check network status
        function checkNetworkStatus() {
            return navigator.onLine;
        }

        // Function to update UI based on network status
        function updateNetworkUI() {
            const isOnline = checkNetworkStatus();
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-indicator span:last-child');

            if (isOnline) {
                statusDot.style.backgroundColor = '#1cc88a'; // Green
                statusText.textContent = 'Connection restored';

                // Enable retry button
                document.getElementById('retryConnectionBtn').disabled = false;
            } else {
                statusDot.style.backgroundColor = '#e74a3b'; // Red
                statusText.textContent = 'Currently offline';

                // Disable retry button if we're still offline
                document.getElementById('retryConnectionBtn').disabled = false;
            }
        }

        // Initialize UI
        updateNetworkUI();

        // Listen for online/offline events
        window.addEventListener('online', updateNetworkUI);
        window.addEventListener('offline', updateNetworkUI);

        // Function to continue in offline mode
        function continueOffline() {
            // Set a flag in localStorage to indicate we're in offline mode
            localStorage.setItem('calibrify_offline_mode', 'true');

            // Add a loading message
            const container = document.querySelector('.offline-container');
            const loadingMsg = document.createElement('p');
            loadingMsg.textContent = 'Loading offline app...';
            loadingMsg.style.marginTop = '20px';
            loadingMsg.style.fontStyle = 'italic';
            container.appendChild(loadingMsg);

            // Redirect to the home page
            window.location.href = '/';
        }

        // Handle continue offline button
        document.getElementById('continueOfflineBtn').addEventListener('click', continueOffline);

        // Handle retry connection button
        document.getElementById('retryConnectionBtn').addEventListener('click', function() {
            if (checkNetworkStatus()) {
                // If we're online, clear the offline mode flag
                localStorage.removeItem('calibrify_offline_mode');

                // Redirect to the home page
                window.location.href = '/';
            } else {
                alert('Still offline. Please check your internet connection and try again.');
            }
        });

        // Auto-redirect after 3 seconds if this is a PWA
        if (isPwa) {
            setTimeout(continueOffline, 3000);
        }
    </script>
</body>
</html>
