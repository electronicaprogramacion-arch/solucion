@page "/repeatibility/{EntityID}"
@using Blazed.Controls;
@inject HttpClient Http
@inject IJSRuntime JSRuntime
@using CalibrationSaaS.Domain.Aggregates.Shared;
@using CalibrationSaaS.Infraestructure.Blazor.Pages.AssetsBasics
@using CalibrationSaaS.Infraestructure.Blazor.Helper

@using CalibrationSaaS.Domain.Aggregates.Querys
@using System.Timers
@namespace CalibrationSaaS.Infraestructure.Blazor.Pages.Order
@inherits CalibrationSaaS.Infraestructure.Blazor.KavokuComponentBase<int>
<style>

    .grid-row1.headerRow {
        height: 55% !important;
    }




    .noedit {
    }




    @@media only screen and (min-device-width : 320px) and (max-device-width : 568px) { /* Aquí van los estilos */


        .editcolumn {
        }

        .container, .container-fluid {
            padding-left: 0rem;
            padding-right: 0rem;
        }

        .container-fluid {
            width: 100%;
            padding-right: 0rem;
            padding-left: 0rem;
            margin-right: auto;
            margin-left: auto;
        }
    }
</style>


@if (LIST != null)
{


    <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion" style="display:none">
        <div class="card-body">
            @if (WeightSetList2 != null)
            {
                <div class="" style="max-height:300px;overflow:auto;width:100%">

                    <WeightSetComponent @ref="@WeightSetComponent" ChangeDescription="ChangeDescripcion">

                    </WeightSetComponent>
                </div>
            }
        </div>
    </div>




    <div class="row">


        <div class="col" style="max-height:500px">
            <EditForm Model="@Entity">
                <ResponsiveTable ItemsDataSource="LIST"
                                 PageSize="20"
                                 HasAction="false"
                                 HasSelect="false"
                                 HasDelete="false"
                                 HasEdit="false"
                                 @ref="@RT"
                                 EnabledModal="true"
                                 Context="ITEM"
                                 TableItem="Domain.Aggregates.Entities.BasicCalibrationResult"
                                 ForceNEwButton="false"
                                 ClientPagination="true"
                                 DisabledRowHover="true"
                                 InLineEdit="true"
                                 NewItemDefaultItem="DefaultNew"
                                 ColActionHeaderCSS="col-sm-2"
                                 ColActionCSS="col-sm-2"
                                 EnabledSearch="false"
                                 HeaderRowClass="row grid-row1 headerRow displayFlex"
                                 Component="@Component"
                                 AfterAction="@TaskAfterSave"
                                 RowAfterRender="@RowAfterRender">

                    <GridHeader>

                        @*<div class="displayFlex noinv">*@
                        <div class="col"></div>
                        <div class="col">Weight Applied</div>
                        <div class="col">Low<br /> Tolerance</div>
                        <div class="col">High<br />Tolerance</div>
                        <div class="col">UOM</div>
                        <div class="col">As Found</div>
                        <div class="col">Result</div>
                        <div class="col">As Left</div>
                        <div class="col">Result</div>
                        <div class="col"></div>



                    </GridHeader>


                    <NewButton>



                        <div class="row" style="width:100%">
                            <div class="col marginButton">
                                <button class="d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="width:100%" @onclick=@(async () => await AddNewItem()) @onclick:stopPropagation @onclick:preventDefault
                                        aria-expanded="false" aria-controls="collapseTwo">
                                    <span>
                                        New Repeatability
                                        <i class="fas fa-plus fa-sm"></i>
                                    </span>

                                </button>
                            </div>
                            <div class="col marginButton">
                                <button class="d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="width:100%" @onclick=@(async () => await SelectWeight(Entity)) @onclick:stopPropagation @onclick:preventDefault
                                        aria-expanded="false" aria-controls="collapseTwo">
                                    Set Weights
                                </button>
                            </div>

                            <div class="col">
                                <div class="input-group mb-3">
                                    <input id="txtName" @bind-value="@TextValue" type="number" disabled="@eq.IsAccredited" class="form-control" aria-label="Recipient's username" aria-describedby="basic-addon2">
                                    <div class="input-group-append">
                                        <button class="d-sm-inline-block btn btn-sm btn-primary shadow-sm" disabled="@eq.IsAccredited" @onclick=@(async () => await SaveACC()) @onclick:stopPropagation @onclick:preventDefault
                                                aria-expanded="false" aria-controls="collapseTwo">
                                            Assign Weight
                                        </button>
                                    </div>
                                </div>
                            </div>

                            @*<div class="col">
                                    <input id="txtName" @bind-value="@TextValue" type="number" disabled="@eq.IsAccredited" />
                                </div>
                                <div class="col">
                                    <button class="d-sm-inline-block btn btn-sm btn-primary shadow-sm" disabled="@eq.IsAccredited" @onclick=@(async () => await SaveACC()) @onclick:stopPropagation @onclick:preventDefault
                                            aria-expanded="false" aria-controls="collapseTwo">
                                        Assign Weight
                                     </button>
                                 </div>*@
                        </div>
                    </NewButton>
                    <GridRow>
                        @{
                            var Decimals = 0;
                            var Resolution = "";
                            if (Entity.TestPoint != null)
                            {
                                Decimals = Entity.TestPoint.DecimalNumber;
                                Resolution = Entity.TestPoint.Resolution.ToString();
                            }
                            else
                            {
                                Decimals = eq.DecimalNumber;
                                Resolution = eq.Resolution.ToString();
                            }
                        }
                        <div class="" style="width:100%">

                            <div class="row displayFlex">
                                <div class="col">
                                    <MaterializeComponent>
                                        <Content>
                                            @ITEM.Position
                                        </Content>
                                    </MaterializeComponent>


                                </div>

                                <div class="col">
                                    <MaterializeComponent>
                                        <Content>
                                            @*@ITEM.WeightApplied*@
                                            <TextInput @bind-Value="@ITEM.WeightApplied"
                                                       Type=@Types.numberdecimal
                                                       Validate="false"
                                                       ValidationFor="()=> ITEM.WeightApplied"
                                                       TValue="double"
                                                       IsDisabled="false"
                                                       LabelDown="true"
                                                       StepResol="@Resolution"
                                                       DecimalNumbers="@Decimals">
                                            </TextInput>
                                        </Content>
                                    </MaterializeComponent>
                                </div>

                                <div class="col">
                                    <TextInput @bind-Value="@ITEM.LowerTolerance"
                                               Type=@Types.numberdecimal
                                               Validate="false"
                                               OnChangeControl="@(async (e) => ChangeValue("LowerTolerance", e))"
                                               ValidationFor="() => ITEM.LowerTolerance"
                                               TValue="double"
                                               IsDisabled="true"
                                               LabelDown="true"
                                               StepResol="@Resolution"
                                               DecimalNumbers="@Decimals">

                                    </TextInput>
                                </div>

                                <div class="col">
                                    <TextInput @bind-Value="@ITEM.UpperTolerance"
                                               Type=@Types.numberdecimal
                                               Validate="false"
                                               OnChangeControl="@(async (e) => ChangeValue("UpperTolerance", e))"
                                               ValidationFor="() => ITEM.UpperTolerance"
                                               TValue="double"
                                               IsDisabled="true"
                                               LabelDown="true"
                                               StepResol="@Resolution"
                                               DecimalNumbers="@Decimals">

                                    </TextInput>
                                </div>

                                <div class="col noedit">

                                    <MaterializeComponent>
                                        <Content>
                                            @ITEM?.UnitOfMeasureID.GetUoM(AppState.UnitofMeasureList).Abbreviation
                                        </Content>
                                    </MaterializeComponent>

                                </div>

                                <div class="col">
                                    <TextInput @bind-Value="@ITEM.AsFound"
                                               OnChangeControl="@(async (arg) => await ChangeControl2(arg,ITEM,true))"
                                               Type=@Types.numberdecimal
                                               Validate="false"
                                               ValidationFor="()=> ITEM.AsFound"
                                               TValue="double"
                                               IsDisabled="!Enabled"
                                               LabelDown="false"
                                               StepResol="@Resolution"
                                               DecimalNumbers="@Decimals"
                                               DecimalRoundType="RoundType.RoundToResolution"
                                               EnableToastMessage="true"
                                               CSSClass="inputgrid"
                                               Id="@("repAsFoundTexbox_" + ITEM.SequenceID.ToString())"
                                               ToastMessage=@("in Repeatability  (As Found) the typed value {0} was rounded to {1}")>
                                    </TextInput>

                                </div>
                                <div class="col">
                                    <MaterializeComponent>
                                        <Content>
                                            <TextInput @bind-Value="@ITEM.InToleranceFound"
                                                       Type=@Types.text
                                                       Validate="false"
                                                       ValidationFor="() => ITEM.InToleranceFound"
                                                       TValue="string"
                                                       IsDisabled="true"
                                                       CSSClass="inputgrid"
                                                       LabelDown="true">

                                            </TextInput>
                                        </Content>
                                    </MaterializeComponent>
                                </div>
                                <div class="col">
                                    <TextInput @bind-Value="@ITEM.AsLeft"
                                               OnChangeControl="@(async (arg) => await ChangeControl2(arg,ITEM,true))"
                                               Type=@Types.numberdecimal
                                               Validate="false"
                                               ValidationFor="()=> ITEM.AsLeft"
                                               TValue="double"
                                               IsDisabled="!Enabled"
                                               LabelDown="false"
                                               StepResol="@Resolution"
                                               DecimalNumbers="@Decimals"
                                               DecimalRoundType="RoundType.RoundToResolution"
                                               EnableToastMessage="true"
                                               CSSClass="inputgrid"
                                               Id="@("repAsLeftTexbox_" + ITEM.SequenceID.ToString())"
                                               ToastMessage=@("in Repeatability  (As Found) the typed value {0} was rounded to {1}")>
                                    </TextInput>

                                </div>
                                <div class="col">
                                    <MaterializeComponent>
                                        <Content>
                                            <TextInput @bind-Value="@ITEM.InToleranceLeft"
                                                       Type=@Types.text
                                                       Validate="false"
                                                       ValidationFor="() => ITEM.InToleranceLeft"
                                                       TValue="string"
                                                       IsDisabled="true"
                                                       LabelDown="true">

                                            </TextInput>
                                        </Content>
                                    </MaterializeComponent>
                                </div>
                                <div class="col">
                                    <MaterializeComponent>
                                        <Content>

                                            @if (RT.TotalRenderRow > 0 && RT.TotalRenderRow - 1 == RT.CurrentRenderIndexRow)
                                            {

                                                @*<button class="btn btn-sm btn-warning shadow-sm"
                                                            id="" @onclick=@(async () => await  DeleteI(ITEM))
                                                            @onclick:stopPropagation @onclick:preventDefault>
                                                        Delete
                                                    </button>*@

                                                <a class="btn btn-sm btn-danger shadow-sm customlink"
                                                   id="" @onclick=@(async () => await  DeleteI(ITEM))
                                                   @onclick:stopPropagation @onclick:preventDefault disabled="@(!Enabled)">
                                                    Delete
                                                </a>

                                            }
                                            else
                                            {

                                                <button class="btn btn-sm btn-danger shadow-sm" disabled
                                                        id="" @onclick=@(async () => await  RT.DeleteItem(ITEM))
                                                        @onclick:stopPropagation @onclick:preventDefault>
                                                    Delete
                                                </button>

                                            }

                                        </Content>
                                    </MaterializeComponent>
                                </div>
                            </div>

                        </div>

                    </GridRow>



                    <GridSelect>
                        @if (!EnableWeightSet)
                        {
                            <button class="btn btn-sm btn-primary shadow-sm editButton" disabled
                                    id="setw"
                                    @onclick:stopPropagation @onclick:preventDefault>
                                Weight
                            </button>
                        }
                        else
                        {
                            <button class="btn btn-sm btn-primary shadow-sm editButton"
                                    id="setw" @onclick=@(async () => await  SelectWeight(ITEM.Repeatability))
                                    @onclick:stopPropagation @onclick:preventDefault>
                                Weight
                            </button>
                        }

                    </GridSelect>

                    <GridEdit>

                        <div class="form-row" style="width:100%">
                            <div class="col-sm">
                                <div class="row">

                                    <div class="col-sm-1 linearityCol inv noedit">Weight Applied</div>
                                    <div class="col-sm-1 linearityCol noedit">@ITEM.WeightApplied</div>
                                    <div class="col-sm-1 linearityCol inv noedit">Repeatability Number</div>
                                    <div class="col-sm-1 ">@ITEM.Position</div>
                                    <div class="col-sm-1 linearityCol inv noedit">UOM</div>
                                    <div class="col-sm-1 linearityCol">@ITEM?.UnitOfMeasure?.Abbreviation</div>
                                    <div class="col-sm-1 linearityCol inv editcolumn">AsFound</div>
                                    <div class="col-sm-2 linearityCol editcolumn">
                                        <TextInput @bind-Value="@ITEM.AsFound"
                                                   CSSClass="inputgrid"
                                                   Type=@Types.number
                                                   Validate="false"
                                                   ValidationFor="@(()=> @ITEM.AsFound)"
                                                   TValue="double"
                                                   IsDisabled="!Enabled">
                                        </TextInput>
                                    </div>
                                    <div class="col-sm-1 linearityCol inv editcolumn">AsLeft</div>
                                    <div class="col-sm-2 linearityCol editcolumn">
                                        <TextInput @bind-Value="@ITEM.AsLeft"
                                                   CSSClass="inputgrid"
                                                   Type=@Types.number
                                                   Validate="false"
                                                   ValidationFor="@(()=> @ITEM.AsLeft)"
                                                   TValue="double"
                                                   IsDisabled="!Enabled">
                                        </TextInput>

                                    </div>

                                </div>
                            </div>

                        </div>

                    </GridEdit>
                </ResponsiveTable>
            </EditForm>

        </div>

    </div>

}



@code {


}
