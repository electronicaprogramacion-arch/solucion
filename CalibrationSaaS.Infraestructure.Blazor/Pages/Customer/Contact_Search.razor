@page "/ContactSearch"
@inherits Contact_SearchBase
@using CalibrationSaaS.Infraestructure.Blazor.Shared.Component
@using Blazed.Controls
@using CalibrationSaaS.Infraestructure.Blazor.Pages.Customer
@using CalibrationSaaS.Domain.Aggregates.Querys

    <div class="card-body" style="z-index:100000">
        <HeaderComponent Title="Contact" ActionBar="false"></HeaderComponent>
        <ResponsiveTable ItemsDataSource="@ListContact"
                         PageSize="paginaSize"
                         HasAction="true"
                         Context="Entity"
                         @ref="@Grid"
                         GridID="gridContact"
                         InLineEdit="false"
                         RowEditClass=""
                         RowNewClass=""
                         TableItem="Contact"
                         EnabledSearch="true"
                         editContext="@CurrentEditContext"
                         EnabledModal="false"
                         OnChangeWindow="ClearList"
                         SelectOnly="@SelectOnly"
                         SaveButtonSubmit="false"
                         PaginationFunction1="LoadData"
                
                         DeleteAction="Delete"
                         Component="@Component">

            <ChildContent>

                <GridColumns>
                    <GridColumn TableItem="Contact" Field="@Grid.GetPropertyName(() => eq.ContactID)" Title="ID" CSScol="col-sm-2 customcol" />
                    <GridColumn TableItem="Contact" Field="@Grid.GetPropertyName(() => eq.Name)" Title="Name" DefaultSort="true" />
                    <GridColumn TableItem="Contact" Field="@Grid.GetPropertyName(() => eq.LastName)" Title="Last Name" />
                    <GridColumn TableItem="Contact" Field="@Grid.GetPropertyName(() => eq.Email)" Title="Email" />
                    <GridColumn TableItem="Contact" Field="@Grid.GetPropertyName(() => eq.PhoneNumber)" Title="Phone" />
                </GridColumns>

            </ChildContent>

            <GridRow>
                <!-- Grid row content will be automatically generated by ResponsiveTable -->
            </GridRow>

            <GridSelect>
                <button class="btn btn-sm btn-primary" id="_btnselect"
                        @onclick=@(async (arg) => await Select(arg, @Entity)) @onclick:stopPropagation @onclick:preventDefault>
                    select
                </button>
            </GridSelect>
            
            <NewButton>
                <a class="btn btn-primary btn-sm" href="Contact/0">
                    <span>new 
                    @*<i class="fas fa-plus fa-sm"></i>*@
                    </span>
                </a>
            </NewButton>
            
            <EditButton>
                <div class="form-group" style="margin-top:0rem;margin-bottom:0rem">
                    <a class="d-sm-inline-block btn btn-sm btn-primary shadow-sm editButton" href="Contact/@Entity.ContactID">
                        <span>edit <i class="fas fa-pen fa-sm"></i></span>
                    </a>
                </div>
            </EditButton>
   
        </ResponsiveTable>
    </div>
@code
{
    void Close(ChangeEventArgs arg)
    {
        var a = (ModalResult)arg.Value;

        if (a.Data != null)
        {
            StateHasChanged();
        }
    }

    void CloseEdit(ChangeEventArgs arg)
    {
        var a = (ModalResult)arg.Value;

        if (a.Data != null)
        {
            StateHasChanged();
        }
    }

    async Task Select(object arg, Contact entity)
    {
        await CloseModal(entity);
    }

    public void ClearList(EventArgs arg)
    {
        // Clear list implementation if needed
    }
}
