@page "/AddressSearchTest"
@using CalibrationSaaS.Domain.Aggregates.Entities
@using CalibrationSaaS.Models.ViewModels
@using Blazed.Controls
@inject IModalService Modal

<h3>Address Search Modal Test</h3>

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <h4>Test Address Search Modal</h4>
            <button class="btn btn-primary" @onclick="ShowAddressModal">
                Open Address Search Modal
            </button>
            
            @if (selectedAddress != null)
            {
                <div class="mt-3">
                    <h5>Selected Address:</h5>
                    <div class="card">
                        <div class="card-body">
                            <p><strong>Address ID:</strong> @selectedAddress.AddressId</p>
                            <p><strong>Customer ID:</strong> @selectedAddress.CustomerID</p>
                            <p><strong>Customer Name:</strong> @selectedAddress.CustomerName</p>
                            <p><strong>Street:</strong> @selectedAddress.StreetAddress1</p>
                            <p><strong>City:</strong> @selectedAddress.City</p>
                            <p><strong>State:</strong> @selectedAddress.State</p>
                            <p><strong>Zip Code:</strong> @selectedAddress.ZipCode</p>
                            <p><strong>Country:</strong> @selectedAddress.Country</p>
                        </div>
                    </div>
                </div>
            }
        </div>
        
        <div class="col-md-6">
            <h4>Using SearchButtonComponent</h4>
            <SearchButtonComponent FormType="typeof(Address_Search)"
                                   Size="@ModalSize.MediumWindow"
                                   Text="Select Address with Component"
                                   Enabled="true"
                                   Parameters="@addressParameters"
                                   CloseWindow="OnAddressSelected">
            </SearchButtonComponent>
            
            @if (selectedAddressFromComponent != null)
            {
                <div class="mt-3">
                    <h5>Selected Address (Component):</h5>
                    <div class="card">
                        <div class="card-body">
                            <p><strong>Address ID:</strong> @selectedAddressFromComponent.AddressId</p>
                            <p><strong>Customer ID:</strong> @selectedAddressFromComponent.CustomerID</p>
                            <p><strong>Customer Name:</strong> @selectedAddressFromComponent.CustomerName</p>
                            <p><strong>Street:</strong> @selectedAddressFromComponent.StreetAddress1</p>
                            <p><strong>City:</strong> @selectedAddressFromComponent.City</p>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private AddressCustomerViewModel selectedAddress;
    private AddressCustomerViewModel selectedAddressFromComponent;
    private ModalParameters addressParameters;
    
    protected override void OnInitialized()
    {
        addressParameters = new ModalParameters();
        addressParameters.Add("SelectOnly", true);
        addressParameters.Add("IsModal", true);
    }
    
    private async Task ShowAddressModal()
    {
        var parameters = new ModalParameters();
        parameters.Add("SelectOnly", true);
        parameters.Add("IsModal", true);
        
        ModalOptions op = new ModalOptions();
        op.ContentScrollable = true;
        op.Class = "blazored-modal " + ModalSize.MediumWindow;
        
        var messageForm = Modal.Show<Address_Search>("Select Address", parameters, op);
        var result = await messageForm.Result;
        
        if (!result.Cancelled && result.Data != null)
        {
            selectedAddress = (AddressCustomerViewModel)result.Data;
            StateHasChanged();
        }
    }
    
    private async Task OnAddressSelected(ChangeEventArgs args)
    {
        var modalResult = (ModalResult)args.Value;
        if (!modalResult.Cancelled && modalResult.Data != null)
        {
            selectedAddressFromComponent = (AddressCustomerViewModel)modalResult.Data;
            StateHasChanged();
        }
    }
}
