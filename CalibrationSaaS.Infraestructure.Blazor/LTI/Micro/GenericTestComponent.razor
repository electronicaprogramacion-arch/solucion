@using Blazed.Controls
@inject HttpClient Http
@inject IJSRuntime JSRuntime
@using CalibrationSaaS.Domain.Aggregates.Shared;
@using CalibrationSaaS.Infraestructure.Blazor.Pages.AssetsBasics
@using CalibrationSaaS.Infraestructure.Blazor.Helper
@using CalibrationSaaS.Infraestructure.Blazor.Services
@using CalibrationSaaS.Domain.Aggregates.Interfaces
@using CalibrationSaaS.Domain.Aggregates.Querys
@namespace CalibrationSaaS.Infraestructure.Blazor
@typeparam CalibrationItem
@typeparam CalibrationItemResult

@*@inherits CalibrationSaaS.Infraestructure.Blazor.ASTMRockAsleftComponentBase<CalibrationItem,CalibrationItemResult>*@
@inherits CalibrationSaaS.Infraestructure.Blazor.GridResultsComponentBase<GenericCalibration>
<style>

    .grid-row1.headerRow {
        height: 55% !important;
    }

  

    .noedit {
    }

    .btnWidth {
        width: 75px
    }


    .secondGrid {
        /*padding-left: 70px*/
        /*left:-7%;*/
    }

    .linearityCol {
        padding: 0px;
    }

    .linearityColHeader {
        padding: 0px;
    }

    .AlingRight {
        float:right
    }

     .AlingLeft {
        float: left
    }



    @@media only screen and (min-device-width : 320px) and (max-device-width : 568px) { /* Aquí van los estilos */
        /*  .editcolumn {
        }

        .container, .container-fluid {
            padding-left: 0rem;
            padding-right: 0rem;
        }

        .container-fluid {
            width: 100%;
            padding-right: 0rem;
            padding-left: 0rem;
            margin-right: auto;
            margin-left: auto;
        }*/
    }
</style>


@if (WorkOrderItemCreate.eq != null && LIST != null && eq != null)
{


    <div style="display:none">
        WeightSets :   @Description
        @if (WeightSetList2 != null)
        {
            <div class="" style="max-height:300px;overflow:auto;width:100%">

               
            </div>
        }
    </div>

    <div class="@CalibrationSubTypeView.CSSGrid">
        @if (1 == 1)
        {
            var tem = LIST;
            string sortField = "";
            bool HasSelect = true;
            bool HasNew = true;
            bool HasDuplicate = false;
            bool EnabledDrag = false;
            bool HasDelete = false;
            int  PageSize2 = 20;
            string ColButtonActionCSS = "btnWidth";
            string ColActionCSS = "btnWidth";
            string AlingActionCSS = "AlingLeft";
            bool ActionBeginRow = false;
            string KeyGrid = "SequenceID";
            
            //@Grid.GetPropertyName(() => PieceOfEquipment.EquipmentTemplate.EquipmentTypeObject.Name)
            @if (CalibrationSubTypeView != null)
            {
                HasSelect = CalibrationSubTypeView.EnabledSelect;
                 HasNew = CalibrationSubTypeView.EnabledNew;
                HasDuplicate = CalibrationSubTypeView.EnabledDuplicate;
                EnabledDrag = CalibrationSubTypeView.EnabledDrag;
                HasDelete = CalibrationSubTypeView.EnabledDelete;
                PageSize2 = CalibrationSubTypeView.PageSize;
                if (!string.IsNullOrEmpty(CalibrationSubTypeView.ColButtonActionCSS))
                {
                    ColButtonActionCSS = CalibrationSubTypeView.ColButtonActionCSS;
                }
                if (!string.IsNullOrEmpty(CalibrationSubTypeView.ColActionCSS))
                {

                    ColActionCSS = CalibrationSubTypeView.ColActionCSS;
                
                }

                if (!string.IsNullOrEmpty(CalibrationSubTypeView.AlingActionCSS))
                {

                    AlingActionCSS = CalibrationSubTypeView.AlingActionCSS;

                }

                if (!string.IsNullOrEmpty(CalibrationSubTypeView.Key))
                {

                   
                    KeyGrid = CalibrationSubTypeView.Key;

                }
                
                if (CalibrationSubTypeView.EnableButtonBar)
                {
                    ColButtonActionCSS = "col";
                    ColActionCSS = "col-12";
                    AlingActionCSS = "AlingRight";
                    ActionBeginRow = true;
                    CalibrationSubTypeView.CSSForm = "col-12";

                }
               

            }



        <ResponsiveTable ItemsDataSource="LIST"
                         PageSize="@PageSize2"
                         HasAction="true"
                         HasSelect="@HasSelect"
                         HasDelete="@HasDelete"
                         HasDuplicate="@HasDuplicate"
                         HasEdit="false"
                         HasNew="@HasNew"
                         @ref="@RT"
                         Context="ITEM"
                         TableItem="CalibrationItem"
                         ForceNEwButton="false"
                         ClientPagination="true"
                         DisabledRowHover="true"
                         InLineEdit="false"
                         ColActionHeaderCSS="col-sm-2"
                         EnabledSearch="false"
                         ClientDefaultSortField="@SortField"
                         ClientDefaultSortDirection="asc"
                         RowExecute="RowChange"
                         Component="@Component"
                         RowAfterRender="@RowAfterRender"
                         AfterAction="@TaskAfterSave"
                         ColActionCSS="@ColActionCSS"
                         EnabledDrag="@EnabledDrag"
                         LabelHeader="true"
                         Key="@KeyGrid"
                         ActionBeginRow="@ActionBeginRow"
                         ColButtonActionCSS="@ColButtonActionCSS"
                         AlingActionCSS="@AlingActionCSS"
                         Enabled="@Enabled"
                         ShowHeader="@CalibrationSubTypeView.ShowHeader">
                         
           
           <GridHeader2>
                @if (ITEM != null && ITEM.BasicCalibrationResult != null )
                {
                   
                            @if (eq != null && eq.CalibrationTypeId >= 1)
                            {
                                var cst = eq.CalibrationSubTypes.Where(x => x.CalibrationSubTypeId == IsCompresion).FirstOrDefault();
                                @if(cst != null && cst?.DynamicPropertiesSchema?.Count > 0 && cst.CalibrationSubTypeView.ShowHeader)
                                    {
                                <EditForm Model="@ITEM" class="@cst.CalibrationSubTypeView.CSSRowHeader">
                                    
                                    <div class="@cst.CalibrationSubTypeView.CSSRow">

                                   
                                    <Blazed.Controls.MultiComponent.MultipleComponent   DynamicProperties="cst.DynamicPropertiesSchema.ToList()"
                                                                   OnlyHeader="true">

                                    </Blazed.Controls.MultiComponent.MultipleComponent>
                                   </div>
                                </EditForm>
                                   
                                    }


                            }
                       
                   
                }
            </GridHeader2>

                <GridRow>
                    @if (ITEM != null && ITEM.BasicCalibrationResult != null)
                    {
                        @*int DecimalNumber = ITEM.BasicCalibrationResult.DecimalNumber + 1;*@

                        <CascadingValue Value="@ITEM" Name="itemgrid">


                            @if (eq != null && eq?.CalibrationTypeId >= 1 && eq?.CalibrationSubTypes?.Count > 0)
                            {
                                var cst = eq.CalibrationSubTypes.Where(x => x.CalibrationSubTypeId == IsCompresion).FirstOrDefault();

                                <EditForm Model="@ITEM" class="@cst.CalibrationSubTypeView.CSSForm">

                                    @if(cst != null && cst?.DynamicPropertiesSchema?.Count > 0)
                                    {

                                        <div class="@cst.CalibrationSubTypeView.CSSRow">


                                            <Blazed.Controls.MultiComponent.MultipleComponent
                                            Enabled="@Enabled"
                                            DynamicProperties="cst.DynamicPropertiesSchema.ToList()"
                                            ChangeEvent="ChangeMultipleControl"
                                            Refresh="@refresh"
                                            IsRowView="@cst.CalibrationSubTypeView.IsRowView"
                                            UseResult="@cst.CalibrationSubTypeView.UseResult.Value"
                                            cmcValues="cmcValues"
                                            @ref="@MultipleComponent">

                                            </Blazed.Controls.MultiComponent.MultipleComponent>



                                        </div>

                                        <div class="@("row " + CalibrationSubTypeView.CSSRowSeparator)" >
                                        </div>


                                    
                                    }
                                    else
                                    {
                                    <div class="row">
                                        <div class="col">
                                            Not configured properties
                                        </div>
                                    </div>
                                    }

                                </EditForm>

                    }



                       
                        </CascadingValue>
                    }
                </GridRow>

                <GridSelect2 Context="select">

                    @{
                        var a = new ResponsiveTable<CalibrationItem>.SelectRow();
                        if (select != null)
                        {
                            a = select as ResponsiveTable<CalibrationItem>.SelectRow;
                        }

                        var color = "";

                    }

                    <div class="row" rt="TTT">


                        @if ((a.Entity.WeightSets != null && a.Entity.WeightSets.Count > 0) || a?.Entity?.Standards?.Count > 0)
                        {
                            color = "success";
                        }
                        else
                        {
                            color = "primary";
                        }



                        @if ((!Enabled || !EnableWeightSet) && Enabled)
                        {
                           
                            <div class="btnWidth buttonLin">
                                <button class="btn btn-sm btn-@color shadow-sm editButton"
                            id="@("btnSelect_" + a.Position.ToString())" @onclick=@(async () => await SelectWeight(a.Entity,a.Position))
                            @onclick:stopPropagation @onclick:preventDefault>
                                    Standard
                                </button>
                            </div>
                        }
                        else if (a != null && a.Entity != null && WorkOrderItemCreate.eq != null && EnableWeightSet && Enabled
                        || a != null && a.Entity != null && WorkOrderItemCreate.eq != null && WorkOrderItemCreate.eq.IsAccredited.HasValue && WorkOrderItemCreate.eq.IsAccredited.Value == true && Enabled)
                        {
                            <div class="btnWidth buttonLin">
                                <button class="btn btn-sm btn-@color shadow-sm editButton"
                            id="@("btnSelect_" + a.Position.ToString())" @onclick=@(async () => await SelectWeight(a.Entity,a.Position))
                            @onclick:stopPropagation @onclick:preventDefault>
                                    Standard
                                </button>
                            </div>
                        }
                        @if (select != null && RT != null && a != null && a?.Entity != null)
                        {

                        }


                    </div>
                </GridSelect2>
        </ResponsiveTable>


            @if (ShowEnviroment)
            {
                <CalibrationSaaS.Infraestructure.Blazor.LTI.Rockwell.EnviromentComponent @ref="EnviromentComponent" IsAsFound="true">


                </CalibrationSaaS.Infraestructure.Blazor.LTI.Rockwell.EnviromentComponent>
            }

           <div class="row">
               <div class="col">
                   @NoDataMessage
               </div>
           </div>
        

      }
    </div>



}
@*else
if (WorkOrderItemCreate.eq != null && LIST != null && LIST.Count == 0)
{
    <div class="row">
    <div>

        No Data configured
</div>
    </div>
}*@


@code {

    async Task newitem(EventArgs obj)
    {

    }


    //public string GetInvalidClass(double a,double b)
    //{
    //    var valid = 0d;
    //    if (b != 0)
    //    {
    //        valid = (a % b);
    //    }
    //    else
    //    {
    //        return "";
    //    }
    //    var c = true;
    //    if(Math.Abs(valid) > 0)
    //    {
    //        c=  Math.Abs(valid % 1) <= (Double.Epsilon * 100);
    //    }

    //    var cssinvalid = "";
    //    if (valid != 0 && !c )
    //    {
    //        cssinvalid = "inputinvalid";
    //    }
    //    return cssinvalid;
    //}


}
